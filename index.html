<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Git Workflow Assistant</title>
    <style>
        :root {
            --bg-color: #f4f6f8;
            --card-bg: #ffffff;
            --primary: #2563eb;
            --primary-hover: #1d4ed8;
            --text-main: #1e293b;
            --text-muted: #64748b;
            --code-bg: #1e1e1e;
            --code-text: #a5b3ce;
            --code-cmd: #4ec9b0;
            --code-arg: #ce9178;
            --success: #10b981;
            --danger: #ef4444;
            --warning-bg: #fffbeb;
            --warning-text: #92400e;
            --border-radius: 8px;
            --track-gray: #e2e8f0;
        }

        body {
            font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.5;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* --- TRACKER SECTION (Optimiert) --- */
        .tracker-card {
            background: var(--card-bg);
            padding: 20px 24px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
            text-align: center;
        }

        .tracker-label {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--text-muted);
            margin-bottom: 15px;
            display: block;
            text-align: left;
        }

        .progress-container {
            position: relative;
            height: 4px; /* Etwas dünner für eleganteren Look */
            background: var(--track-gray);
            border-radius: 10px;
            margin: 30px 20px 20px 20px; /* Platz für Dots */
            z-index: 0;
        }

        .progress-bar {
            position: absolute;
            left: 0;
            top: 0;
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, #60a5fa 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1;
        }

        .progress-steps {
            position: absolute;
            top: -14px; /* Dots vertikal zentrieren zur Linie */
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0; 
            z-index: 2;
            pointer-events: none; /* Klicks gehen durch */
        }

        .step-dot {
            width: 32px;
            height: 32px;
            background: var(--card-bg); /* Weißer Hintergrund default */
            border-radius: 50%;
            border: 2px solid var(--track-gray);
            color: var(--text-muted);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            transition: all 0.4s ease;
            position: relative;
        }

        /* Status: In Arbeit (Aktiv) */
        .step-dot.active {
            border-color: var(--primary);
            color: var(--primary);
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.15);
            transform: scale(1.1);
            background: var(--card-bg);
            z-index: 3;
        }

        /* Status: Erledigt */
        .step-dot.done {
            background: var(--success);
            border-color: var(--success);
            color: white;
            transform: scale(1);
            box-shadow: none;
        }

        .tracker-reset-link {
            display: inline-block;
            margin-top: 15px;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.2s;
        }
        .tracker-reset-link:hover { color: var(--danger); }


        /* --- Header & Settings --- */
        .header-section {
            background: var(--card-bg);
            padding: 24px;
            border-radius: var(--border-radius);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 24px;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .header-title { margin: 0; font-size: 1.25rem; }

        .settings-bar {
            display: flex;
            background: #f1f5f9;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 20px;
            align-items: center;
            gap: 15px;
            font-size: 0.9rem;
        }

        select {
            padding: 6px 10px;
            border-radius: 4px;
            border: 1px solid #cbd5e1;
            background: white;
            font-family: inherit;
        }

        .input-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .input-group { display: flex; flex-direction: column; }
        
        label {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 8px;
            color: var(--text-muted);
        }

        input {
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 6px;
            font-size: 1rem;
            transition: border-color 0.2s;
        }

        input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        /* Global Reset Button */
        .reset-btn {
            background: transparent;
            border: 1px solid #e2e8f0;
            color: var(--text-muted);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }
        .reset-btn:hover { border-color: var(--danger); color: var(--danger); background: #fef2f2; }

        /* --- Workflow Steps --- */
        .step-card {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            border-left: 5px solid var(--primary);
            position: relative;
            transition: transform 0.2s;
        }
        
        /* Animation wenn Step completed */
        .step-card.step-completed {
            border-left-color: var(--success) !important;
            opacity: 0.7; /* Leicht ausgrauen für Fokus auf nächsten Schritt */
        }
        .step-card.step-completed::after {
            content: '✓';
            position: absolute;
            top: 24px;
            right: 24px;
            font-weight: bold;
            color: var(--success);
            font-size: 1.2rem;
        }

        .step-title {
            margin: 0 0 16px 0;
            font-size: 1.1rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .step-number {
            background: var(--primary);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
        }

        /* --- Command Row --- */
        .command-wrapper {
            display: flex;
            align-items: stretch;
            gap: 0;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            overflow: hidden;
            background: var(--code-bg);
            min-height: 54px; 
        }

        .code-display {
            flex-grow: 1;
            padding: 16px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.95rem;
            color: var(--code-text);
            overflow-x: auto;
            white-space: pre-wrap;
            display: flex;
            align-items: center;
        }

        .cmd { color: var(--code-cmd); }
        .arg { color: var(--code-arg); }
        .sep { color: #dcdcaa; font-weight: bold; }

        .copy-btn {
            width: 120px;
            border: none;
            background: #2d3342;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            border-left: 1px solid #444;
            flex-shrink: 0;
        }

        .copy-btn:hover { background: var(--primary); }
        .copy-btn.copied { background: var(--success); color: white; }

        /* Checklist */
        .checklist {
            list-style: none;
            padding: 0;
            margin: 0;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 10px;
        }
        .checklist li {
            background: #f8fafc;
            padding: 10px;
            border-radius: 4px;
            border: 1px solid #e2e8f0;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checklist input[type="checkbox"] { width: 16px; height: 16px; cursor: pointer; }

        /* Step 2 Done Button */
        .step-2-actions {
            margin-top: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .btn-check-done {
            background: white;
            border: 1px solid var(--primary);
            color: var(--primary);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s;
        }
        .btn-check-done:hover {
            background: #eff6ff;
        }
        .btn-check-done.active {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        .status-hint {
            text-align: right;
            font-size: 0.85rem;
            color: var(--text-muted);
            font-family: monospace;
        }

        .ps-warning {
            display: none;
            margin-top: 10px;
            padding: 10px;
            background: var(--warning-bg);
            color: var(--warning-text);
            border-radius: 4px;
            font-size: 0.85rem;
            border: 1px solid #fcd34d;
        }

        @media (max-width: 600px) {
            .input-grid { grid-template-columns: 1fr; }
            .command-wrapper { flex-direction: column; }
            .copy-btn { width: 100%; height: 40px; border-left: none; border-top: 1px solid #444; }
            .settings-bar { flex-direction: column; align-items: flex-start; }
            .step-2-actions { flex-direction: column; gap: 10px; align-items: stretch; }
            .status-hint { text-align: left; }
        }
    </style>
</head>
<body>

<div class="container">

    <div class="tracker-card">
        <span class="tracker-label">Workflow Fortschritt</span>
        <div class="progress-container">
            <div class="progress-bar" id="progressBar"></div>
            <div class="progress-steps">
                <div class="step-dot" data-step="1" title="Vorbereitung">1</div>
                <div class="step-dot" data-step="2" title="Checkliste">2</div>
                <div class="step-dot" data-step="3" title="Commit">3</div>
                <div class="step-dot" data-step="4" title="Push">4</div>
                <div class="step-dot" data-step="5" title="Aufräumen">5</div>
            </div>
        </div>
        <span class="tracker-reset-link" onclick="resetTrackerOnly()">Tracker zurücksetzen</span>
    </div>

    <div class="header-section">
        <div class="header-top">
            <h1 class="header-title">Git Workflow Helper</h1>
            <button class="reset-btn" id="resetBtn">&#8635; Neues Ticket (Reset)</button>
        </div>

        <div class="settings-bar">
            <label for="terminalType" style="margin:0; color:var(--text-main);">Dein Terminal:</label>
            <select id="terminalType">
                <option value="bash">Git Bash / CMD / Mac (nutzt &&)</option>
                <option value="powershell" selected>Windows PowerShell (nutzt ;)</option>
            </select>
            <span style="color: var(--text-muted); font-size: 0.8rem;">(Ändert das Trennzeichen automatisch)</span>
        </div>

        <div class="input-grid">
            <div class="input-group">
                <label for="branchInput">Branch Name</label>
                <input type="text" id="branchInput" placeholder="feat-meine-aenderung" value="feat-meine-aenderung">
            </div>
            <div class="input-group">
                <label for="commitInput">Commit Message</label>
                <input type="text" id="commitInput" placeholder="UI: Beschreibung" value="UI: Beschreibung der Änderung">
            </div>
        </div>
    </div>

    <div class="step-card" id="card-1">
        <h3 class="step-title"><span class="step-number">1</span> Start: Arbeitsstand vorbereiten</h3>
        <p style="font-size: 0.9rem; margin-bottom: 10px; color: var(--text-muted);">Wechselt zu Main, zieht Updates und erstellt neuen Branch.</p>
        
        <div class="command-wrapper">
            <div class="code-display" id="code-step1">Lade Befehle...</div>
            <button class="copy-btn" data-target="code-step1" data-step-trigger="1">KOPIEREN</button>
        </div>
        <div class="ps-warning" id="ps-warning-1">
            <strong>Hinweis:</strong> PowerShell stoppt bei Fehlern (z.B. Merge Conflicts) nicht automatisch, da es ";" nutzt. Bitte Konsole prüfen.
        </div>
    </div>

    <div class="step-card" id="card-2" style="border-left-color: #f59e0b;">
        <h3 class="step-title"><span class="step-number" style="background: #f59e0b;">2</span> Checkliste: Testen & Prüfen</h3>
        <ul class="checklist" id="checklist-container">
            <li><input type="checkbox"> Navigation (Editor/History)</li>
            <li><input type="checkbox"> Aktive Markierung</li>
            <li><input type="checkbox"> Login Menü (Sidebar unten)</li>
            <li><input type="checkbox"> Scroll-Verhalten OK</li>
            <li><input type="checkbox"> Keine Layout-Brüche</li>
            <li><input type="checkbox"> DevTools Konsole (keine Errors)</li>
        </ul>
        
        <div class="step-2-actions">
            <button class="btn-check-done" id="btnStep2Done" onclick="markStep2Done()">
                <span>&#10003;</span> Checkliste erledigt
            </button>
            <div class="status-hint">
                git status
            </div>
        </div>
    </div>

    <div class="step-card" id="card-3">
        <h3 class="step-title"><span class="step-number">3</span> Änderungen versionieren (Commit)</h3>
        <p style="font-size: 0.9rem; margin-bottom: 10px; color: var(--text-muted);">Fügt index.html & db.js hinzu und erstellt den Commit.</p>

        <div class="status-hint" style="text-align: left; margin-bottom: 5px;">
           Vorher prüfen: git status
        </div>
        <div class="command-wrapper">
            <div class="code-display" id="code-step3">Lade Befehle...</div>
            <button class="copy-btn" data-target="code-step3" data-step-trigger="3">KOPIEREN</button>
        </div>
    </div>

    <div class="step-card" id="card-4">
        <h3 class="step-title"><span class="step-number">4</span> Push nach GitHub</h3>
        
        <div class="command-wrapper">
            <div class="code-display" id="code-step4">Lade Befehle...</div>
            <button class="copy-btn" data-target="code-step4" data-step-trigger="4">KOPIEREN</button>
        </div>
    </div>

    <div class="step-card" id="card-5" style="border-left-color: #ef4444;">
        <h3 class="step-title"><span class="step-number" style="background: #ef4444;">5</span> Aufräumen (Nach dem Merge)</h3>
        <p style="font-size: 0.9rem; margin-bottom: 10px; color: var(--text-muted);">Zurück zu Main, Update ziehen und lokalen Feature-Branch löschen.</p>

        <div class="command-wrapper">
            <div class="code-display" id="code-step5">Lade Befehle...</div>
            <button class="copy-btn" data-target="code-step5" data-step-trigger="5">KOPIEREN</button>
        </div>
    </div>

</div>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        
        // Referenzen UI
        const branchInput = document.getElementById('branchInput');
        const commitInput = document.getElementById('commitInput');
        const terminalSelect = document.getElementById('terminalType');
        const checklistContainer = document.getElementById('checklist-container');
        const psWarning = document.getElementById('ps-warning-1');
        const resetBtn = document.getElementById('resetBtn');
        const btnStep2Done = document.getElementById('btnStep2Done');

        // Tracker Referenzen
        const progressBar = document.getElementById('progressBar');
        const stepDots = document.querySelectorAll('.step-dot');
        
        // Code Container
        const codeStep1 = document.getElementById('code-step1');
        const codeStep3 = document.getElementById('code-step3');
        const codeStep4 = document.getElementById('code-step4');
        const codeStep5 = document.getElementById('code-step5');
        const copyButtons = document.querySelectorAll('.copy-btn');

        // Default Werte
        const DEFAULT_BRANCH = 'feat-meine-aenderung';
        const DEFAULT_COMMIT = 'UI: Beschreibung der Änderung';

        // --- TRACKER LOGIK (V 5.0) ---
        // stepsDone = Anzahl der abgeschlossenen Schritte. 
        // 0 = Start (Step 1 ist aktiv)
        // 1 = Step 1 fertig (Step 2 aktiv) ...
        let stepsDone = 0; 
        const TOTAL_INTERVALS = 4; // Zwischen 5 Punkten gibt es 4 Abstände

        function updateTracker(completedStepIndex) {
            // Wir nehmen an: Wenn Button für Schritt X geklickt wird, ist Schritt X fertig.
            // Der User ist dann im Workflow bei Schritt X+1.
            
            // Nur aktualisieren, wenn wir vorwärts gehen
            if (completedStepIndex > stepsDone) {
                stepsDone = completedStepIndex;
            }

            // 1. Progress Bar Update
            // Wenn Schritt 1 fertig ist, füllen wir 1/4 des Balkens (zu Schritt 2)
            // Wenn Schritt 4 fertig ist, füllen wir 4/4 des Balkens (zu Schritt 5)
            // Limitierung auf 100%
            const percentage = Math.min((stepsDone / TOTAL_INTERVALS) * 100, 100);
            progressBar.style.width = percentage + '%';

            // 2. Dots Update (Status: Done, Active, Pending)
            // Active Step ist immer der nächste nach den erledigten (stepsDone + 1)
            const activeStep = stepsDone + 1;

            stepDots.forEach(dot => {
                const dotNumber = parseInt(dot.getAttribute('data-step'));
                
                // Reset classes
                dot.classList.remove('active', 'done');

                if (dotNumber < activeStep) {
                    // Vergangene Schritte -> Done (Grün)
                    dot.classList.add('done');
                    dot.innerHTML = '&#10003;'; // Checkmark
                } else if (dotNumber === activeStep && dotNumber <= 5) {
                    // Aktueller Schritt -> Active (Blau/Groß)
                    dot.classList.add('active');
                    dot.textContent = dotNumber; // Nummer anzeigen
                } else {
                    // Zukunft -> Normal
                    dot.textContent = dotNumber;
                }
            });

            // 3. Karten visuell markieren
            for(let i=1; i<=5; i++) {
                const card = document.getElementById('card-'+i);
                if(card) {
                    if (i < activeStep) card.classList.add('step-completed');
                    else card.classList.remove('step-completed');
                }
            }
        }

        // Tracker Reset (Auf Startzustand: Step 1 active)
        window.resetTrackerOnly = function() {
            stepsDone = 0;
            progressBar.style.width = '0%';
            
            // UI Reset
            stepDots.forEach(dot => {
                const dotNumber = parseInt(dot.getAttribute('data-step'));
                dot.classList.remove('active', 'done');
                dot.textContent = dotNumber;
                if(dotNumber === 1) dot.classList.add('active'); // Step 1 Start
            });

            // Karten Reset
            document.querySelectorAll('.step-card').forEach(c => c.classList.remove('step-completed'));
            
            // Button 2 Reset
            if(btnStep2Done) {
                btnStep2Done.classList.remove('active');
                btnStep2Done.innerHTML = '<span>&#10003;</span> Checkliste erledigt';
            }
        };
        
        // Button Step 2 Logik
        window.markStep2Done = function() {
            const btn = document.getElementById('btnStep2Done');
            btn.classList.add('active');
            btn.innerHTML = '<span>&#10003;</span> Erledigt!';
            updateTracker(2); // Schritt 2 erledigt -> gehe zu 3
        };

        // --- Helper: HTML Generator ---
        function generateCodeHTML(parts, separator) {
            let html = '';
            parts.forEach((part) => {
                if (part.type === 'sep') {
                    html += ` <span class="sep">${separator}</span> `;
                } else {
                    html += `<span class="${part.type}">${part.text}</span>`;
                }
            });
            return html;
        }

        // --- Haupt-Update Funktion (Commands) ---
        function updateCommands() {
            try {
                const branchVal = branchInput.value.trim() || DEFAULT_BRANCH;
                const commitVal = commitInput.value || DEFAULT_COMMIT;
                const isPowerShell = terminalSelect.value === 'powershell';
                
                const sep = isPowerShell ? ';' : '&&';
                
                if(psWarning) psWarning.style.display = isPowerShell ? 'block' : 'none';

                // Commands Step 1
                if(codeStep1) {
                    codeStep1.innerHTML = generateCodeHTML([
                        { type: 'cmd', text: 'git checkout main' },
                        { type: 'sep', text: sep },
                        { type: 'cmd', text: 'git pull' },
                        { type: 'sep', text: sep },
                        { type: 'cmd', text: 'git checkout -b ' }, 
                        { type: 'arg', text: branchVal }
                    ], sep);
                }

                // Commands Step 3 (db.js included)
                if(codeStep3) {
                    codeStep3.innerHTML = generateCodeHTML([
                        { type: 'cmd', text: 'git add index.html db.js' },
                        { type: 'sep', text: sep },
                        { type: 'cmd', text: 'git commit -m "' },
                        { type: 'arg', text: commitVal },
                        { type: 'cmd', text: '"' }
                    ], sep);
                }

                // Commands Step 4
                if(codeStep4) {
                    codeStep4.innerHTML = generateCodeHTML([
                        { type: 'cmd', text: 'git push -u origin ' },
                        { type: 'arg', text: branchVal }
                    ], sep);
                }

                // Commands Step 5
                if(codeStep5) {
                    codeStep5.innerHTML = generateCodeHTML([
                        { type: 'cmd', text: 'git checkout main' },
                        { type: 'sep', text: sep },
                        { type: 'cmd', text: 'git pull' },
                        { type: 'sep', text: sep },
                        { type: 'cmd', text: 'git branch -D ' },
                        { type: 'arg', text: branchVal }
                    ], sep);
                }

            } catch (e) {
                console.error("Fehler im Skript:", e);
                if(codeStep1) codeStep1.innerText = "Fehler beim Laden";
            }
        }

        // --- Global Reset Funktion ---
        function resetAll() {
            if (confirm('Neues Ticket starten? Alle Eingaben und der Tracker werden zurückgesetzt.')) {
                branchInput.value = DEFAULT_BRANCH;
                commitInput.value = DEFAULT_COMMIT;
                
                const checkboxes = checklistContainer.querySelectorAll('input[type="checkbox"]');
                checkboxes.forEach(cb => cb.checked = false);

                updateCommands();
                resetTrackerOnly(); 
            }
        }

        // --- Copy Funktion mit Tracker Trigger ---
        function handleCopy(btn) {
            const targetId = btn.getAttribute('data-target');
            const stepTrigger = parseInt(btn.getAttribute('data-step-trigger'));
            const container = document.getElementById(targetId);
            
            if(!container) return;

            let textToCopy = container.textContent.replace(/\s+/g, ' ').trim(); 
            
            navigator.clipboard.writeText(textToCopy).then(() => {
                const originalText = btn.innerText;
                btn.innerText = "KOPIERT!";
                btn.classList.add('copied');
                
                // TRACKER UPDATE: Wenn Schritt X kopiert, ist X erledigt.
                if(stepTrigger) {
                    updateTracker(stepTrigger);
                }

                setTimeout(() => {
                    btn.innerText = originalText;
                    btn.classList.remove('copied');
                }, 2000);
            }).catch(err => {
                alert('Fehler beim Kopieren: ' + err);
            });
        }

        // --- Event Listener ---
        if(branchInput) branchInput.addEventListener('input', updateCommands);
        if(commitInput) commitInput.addEventListener('input', updateCommands);
        if(terminalSelect) terminalSelect.addEventListener('change', updateCommands);
        if(resetBtn) resetBtn.addEventListener('click', resetAll);
        
        copyButtons.forEach(btn => {
            btn.addEventListener('click', () => handleCopy(btn));
        });

        // --- Init ---
        terminalSelect.value = 'powershell'; 
        updateCommands();
        resetTrackerOnly(); // Setzt Startzustand (Step 1 active)
    });
</script>

</body>
</html>